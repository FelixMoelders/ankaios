<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" height="596px" preserveAspectRatio="none" style="width:1003px;height:596px;background:#FFFFFF;" version="1.1" viewBox="0 0 1003 596" width="1003px" zoomAndPan="magnify"><defs/><g><rect fill="#A9A9A9" height="584.0938" style="stroke:#D3D3D3;stroke-width:0.5;" width="536.5" x="206" y="6"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="250" x="346.75" y="18.0669">gRPC Communication Middleware</text><rect fill="#EEEEEE" height="563.9609" style="stroke:#D3D3D3;stroke-width:0.5;" width="393.5" x="206" y="26.1328"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="92" x="356.75" y="38.1997">gRPC Server</text><rect fill="#EEEEEE" height="563.9609" style="stroke:#D3D3D3;stroke-width:0.5;" width="111" x="631.5" y="26.1328"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="87" x="643.5" y="38.1997">gRPC Client</text><rect fill="none" height="155.5313" style="stroke:#000000;stroke-width:1.5;" width="793.5" x="194" y="258.8984"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="63" x2="63" y1="76.5625" y2="84.5625"/><line style="stroke:#383838;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="63" x2="63" y1="84.5625" y2="125.3672"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="63" x2="63" y1="125.3672" y2="386.4297"/><line style="stroke:#383838;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="63" x2="63" y1="386.4297" y2="414.4297"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="63" x2="63" y1="414.4297" y2="584.0938"/><rect fill="#FFFFFF" height="261.0625" style="stroke:#FFFFFF;stroke-width:1.0;" width="10" x="58" y="125.3672"/><line style="stroke:#181818;stroke-width:1.0;" x1="58" x2="58" y1="125.3672" y2="386.4297"/><line style="stroke:#181818;stroke-width:1.0;" x1="68" x2="68" y1="125.3672" y2="386.4297"/><line style="stroke:#181818;stroke-width:1.0;" x1="58" x2="68" y1="125.3672" y2="125.3672"/><rect fill="#FFFFFF" height="169.6641" style="stroke:#FFFFFF;stroke-width:1.0;" width="10" x="58" y="414.4297"/><line style="stroke:#181818;stroke-width:1.0;" x1="58" x2="58" y1="414.4297" y2="584.0938"/><line style="stroke:#181818;stroke-width:1.0;" x1="68" x2="68" y1="414.4297" y2="584.0938"/><line style="stroke:#181818;stroke-width:1.0;" x1="58" x2="68" y1="584.0938" y2="584.0938"/><rect fill="#FFFFFF" height="18" style="stroke:#181818;stroke-width:1.0;" width="10" x="63" y="566.0938"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="260" x2="260" y1="76.5625" y2="84.5625"/><line style="stroke:#383838;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="260" x2="260" y1="84.5625" y2="125.3672"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="260" x2="260" y1="125.3672" y2="386.4297"/><line style="stroke:#383838;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="260" x2="260" y1="386.4297" y2="414.4297"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="260" x2="260" y1="414.4297" y2="584.0938"/><rect fill="#FFFFFF" height="172.6641" style="stroke:#181818;stroke-width:1.0;" width="10" x="255" y="189.6328"/><rect fill="#FFFFFF" height="13" style="stroke:#181818;stroke-width:1.0;" width="10" x="260" y="246.8984"/><rect fill="#FFFFFF" height="13" style="stroke:#181818;stroke-width:1.0;" width="10" x="260" y="320.1641"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="505" x2="505" y1="76.5625" y2="84.5625"/><line style="stroke:#383838;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="505" x2="505" y1="84.5625" y2="125.3672"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="505" x2="505" y1="125.3672" y2="386.4297"/><line style="stroke:#383838;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="505" x2="505" y1="386.4297" y2="414.4297"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="505" x2="505" y1="414.4297" y2="584.0938"/><rect fill="#FFFFFF" height="42.1328" style="stroke:#181818;stroke-width:1.0;" width="10" x="500" y="536.9609"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="687" x2="687" y1="76.5625" y2="84.5625"/><line style="stroke:#383838;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="687" x2="687" y1="84.5625" y2="125.3672"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="687" x2="687" y1="125.3672" y2="386.4297"/><line style="stroke:#383838;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="687" x2="687" y1="386.4297" y2="414.4297"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="687" x2="687" y1="414.4297" y2="584.0938"/><rect fill="#FFFFFF" height="42.1328" style="stroke:#181818;stroke-width:1.0;" width="10" x="682" y="349.2969"/><rect fill="#FFFFFF" height="57.2656" style="stroke:#181818;stroke-width:1.0;" width="10" x="682" y="492.6953"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="915" x2="915" y1="76.5625" y2="84.5625"/><line style="stroke:#383838;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="915" x2="915" y1="84.5625" y2="125.3672"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="915" x2="915" y1="125.3672" y2="386.4297"/><line style="stroke:#383838;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="915" x2="915" y1="386.4297" y2="414.4297"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="915" x2="915" y1="414.4297" y2="584.0938"/><rect fill="#FFFFFF" height="261.0625" style="stroke:#FFFFFF;stroke-width:1.0;" width="10" x="910" y="125.3672"/><line style="stroke:#181818;stroke-width:1.0;" x1="910" x2="910" y1="125.3672" y2="386.4297"/><line style="stroke:#181818;stroke-width:1.0;" x1="920" x2="920" y1="125.3672" y2="386.4297"/><line style="stroke:#181818;stroke-width:1.0;" x1="910" x2="920" y1="125.3672" y2="125.3672"/><rect fill="#FFFFFF" height="91.2656" style="stroke:#FFFFFF;stroke-width:1.0;" width="10" x="910" y="414.4297"/><line style="stroke:#181818;stroke-width:1.0;" x1="910" x2="910" y1="414.4297" y2="505.6953"/><line style="stroke:#181818;stroke-width:1.0;" x1="920" x2="920" y1="414.4297" y2="505.6953"/><line style="stroke:#181818;stroke-width:1.0;" x1="910" x2="920" y1="505.6953" y2="505.6953"/><rect fill="#FFFFFF" height="13" style="stroke:#181818;stroke-width:1.0;" width="10" x="915" y="378.4297"/><rect fill="#E3E3E3" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="116" x="5" y="45.2656"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="102" x="12" y="65.2607">Ankaios Server</text><rect fill="#E3E3E3" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="100" x="210" y="45.2656"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="86" x="217" y="65.2607">gRPC Server</text><rect fill="#E3E3E3" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="181" x="414.5" y="45.2656"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="167" x="421.5" y="65.2607">gRPC Agent Connection</text><rect fill="#E3E3E3" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="95" x="639.5" y="45.2656"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="81" x="646.5" y="65.2607">gRPC Client</text><rect fill="#E3E3E3" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="113" x="858.5" y="45.2656"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="99" x="865.5" y="65.2607">Ankaios Agent</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="42" x="468" y="108.7729">Startup</text><rect fill="#EEEEEE" height="3" style="stroke:#EEEEEE;stroke-width:1.0;" width="991.5" x="5" y="145.9336"/><line style="stroke:#000000;stroke-width:1.0;" x1="5" x2="996.5" y1="145.9336" y2="145.9336"/><line style="stroke:#000000;stroke-width:1.0;" x1="5" x2="996.5" y1="148.9336" y2="148.9336"/><rect fill="#EEEEEE" height="23.1328" style="stroke:#000000;stroke-width:2.0;" width="244" x="378.75" y="135.3672"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="225" x="384.75" y="151.4341">Forward Execution Commands</text><line style="stroke:#181818;stroke-width:1.0;" x1="253" x2="243" y1="189.6328" y2="185.6328"/><line style="stroke:#181818;stroke-width:1.0;" x1="253" x2="243" y1="189.6328" y2="193.6328"/><line style="stroke:#181818;stroke-width:1.0;" x1="68" x2="254" y1="189.6328" y2="189.6328"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="168" x="75" y="184.5669">send Execution Command</text><line style="stroke:#181818;stroke-width:1.0;" x1="265" x2="312" y1="233.8984" y2="233.8984"/><line style="stroke:#181818;stroke-width:1.0;" x1="312" x2="312" y1="233.8984" y2="246.8984"/><line style="stroke:#181818;stroke-width:1.0;" x1="271" x2="312" y1="246.8984" y2="246.8984"/><polygon fill="#181818" points="281,242.8984,271,246.8984,281,250.8984" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="148" x="277" y="213.6997">use Common lib to find</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="139" x="281" y="228.8325">commands per Agent</text><path d="M194,258.8984 L271,258.8984 L271,266.0313 L261,276.0313 L194,276.0313 L194,258.8984 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="155.5313" style="stroke:#000000;stroke-width:1.5;" width="793.5" x="194" y="258.8984"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="32" x="209" y="271.9653">loop</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="108" x="286" y="271.1089">[for every Agent]</text><line style="stroke:#181818;stroke-width:1.0;" x1="265" x2="312" y1="307.1641" y2="307.1641"/><line style="stroke:#181818;stroke-width:1.0;" x1="312" x2="312" y1="307.1641" y2="320.1641"/><line style="stroke:#181818;stroke-width:1.0;" x1="271" x2="312" y1="320.1641" y2="320.1641"/><polygon fill="#181818" points="281,316.1641,271,320.1641,281,324.1641" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="221" x="277" y="302.0981">Find Agent tx in AgentSendersMap</text><line style="stroke:#181818;stroke-width:1.0;" x1="680" x2="670" y1="349.2969" y2="345.2969"/><line style="stroke:#181818;stroke-width:1.0;" x1="680" x2="670" y1="349.2969" y2="353.2969"/><line style="stroke:#181818;stroke-width:1.0;" x1="265" x2="681" y1="349.2969" y2="349.2969"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="245" x="272" y="344.231">forward Exection Command over gRPC</text><line style="stroke:#181818;stroke-width:1.0;" x1="913" x2="903" y1="378.4297" y2="374.4297"/><line style="stroke:#181818;stroke-width:1.0;" x1="913" x2="903" y1="378.4297" y2="382.4297"/><line style="stroke:#181818;stroke-width:1.0;" x1="692" x2="914" y1="378.4297" y2="378.4297"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="176" x="699" y="373.3638">forward Exection Command</text><rect fill="#EEEEEE" height="3" style="stroke:#EEEEEE;stroke-width:1.0;" width="991.5" x="5" y="448.9961"/><line style="stroke:#000000;stroke-width:1.0;" x1="5" x2="996.5" y1="448.9961" y2="448.9961"/><line style="stroke:#000000;stroke-width:1.0;" x1="5" x2="996.5" y1="451.9961" y2="451.9961"/><rect fill="#EEEEEE" height="23.1328" style="stroke:#000000;stroke-width:2.0;" width="273" x="364.25" y="438.4297"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="254" x="370.25" y="454.4966">Forward State Change Commands</text><line style="stroke:#181818;stroke-width:1.0;" x1="693" x2="703" y1="492.6953" y2="488.6953"/><line style="stroke:#181818;stroke-width:1.0;" x1="693" x2="703" y1="492.6953" y2="496.6953"/><line style="stroke:#181818;stroke-width:1.0;" x1="692" x2="909" y1="492.6953" y2="492.6953"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="194" x="709" y="487.6294">send State Change Command</text><line style="stroke:#181818;stroke-width:1.0;" x1="511" x2="521" y1="536.9609" y2="532.9609"/><line style="stroke:#181818;stroke-width:1.0;" x1="511" x2="521" y1="536.9609" y2="540.9609"/><line style="stroke:#181818;stroke-width:1.0;" x1="510" x2="681" y1="536.9609" y2="536.9609"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="139" x="527" y="516.7622">forward State Change</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="136" x="531" y="531.895">Command over gRPC</text><line style="stroke:#181818;stroke-width:1.0;" x1="74" x2="84" y1="566.0938" y2="562.0938"/><line style="stroke:#181818;stroke-width:1.0;" x1="74" x2="84" y1="566.0938" y2="570.0938"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="73" x2="499" y1="566.0938" y2="566.0938"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="210" x="90" y="561.0278">forward State Change Command</text><!--MD5=[c46df2e9a412c0cc0fdbd49a56ad777a]
@startuml seq_forward_via_grpc
!include ../../../../doc/plantuml/clean.skin

participant "Ankaios Server" as ankaios_server

box gRPC Communication Middleware #DarkGray
    box gRPC Server
        participant "gRPC Server" as grpc_server
        participant "gRPC Agent Connection" as agent_connection
    end box

    box gRPC Client
        participant "gRPC Client" as grpc_client
    end box
end box

participant "Ankaios Agent" as ankaios_agent


activate ankaios_server
activate ankaios_agent

... Startup ...

== Forward Execution Commands ==

ankaios_server ->> grpc_server ++: send Execution Command

grpc_server -> grpc_server ++- -: use Common lib to find \n commands per Agent

loop for every Agent

    grpc_server -> grpc_server ++- -: Find Agent tx in AgentSendersMap

    grpc_server ->> grpc_client ++- -: forward Exection Command over gRPC

    grpc_client ->> ankaios_agent ++- -: forward Exection Command

    deactivate ankaios_agent

    ...

end

== Forward State Change Commands ==

ankaios_agent ->> grpc_client ++- -: send State Change Command

grpc_client ->> agent_connection ++- -: forward State Change \n Command over gRPC

agent_connection - ->> ankaios_server ++- -: forward State Change Command
@end

@startuml seq_forward_via_grpc
skinparam monochrome true
skinparam guillemet true
skinparam style strictuml
hide empty members
hide empty methods

skinparam class {
    BorderColor<<logical entity>> grey
    FontColor<<logical entity>> grey
    StereotypeFontColor<<logical entity>> grey
}

skinparam sequenceBox {
    BorderColor #LightGrey
    BackgroundColor #EEEEEE
    FontColor #777777
}

skinparam BoxPadding 10

skinparam note {
    BackgroundColor #FFFFFF
}

skinparam nodesep 30
skinparam ranksep 30

!pragma teoz true

participant "Ankaios Server" as ankaios_server

box gRPC Communication Middleware #DarkGray
    box gRPC Server
        participant "gRPC Server" as grpc_server
        participant "gRPC Agent Connection" as agent_connection
    end box

    box gRPC Client
        participant "gRPC Client" as grpc_client
    end box
end box

participant "Ankaios Agent" as ankaios_agent


activate ankaios_server
activate ankaios_agent

... Startup ...

== Forward Execution Commands ==

ankaios_server ->> grpc_server ++: send Execution Command

grpc_server -> grpc_server ++- -: use Common lib to find \n commands per Agent

loop for every Agent

    grpc_server -> grpc_server ++- -: Find Agent tx in AgentSendersMap

    grpc_server ->> grpc_client ++- -: forward Exection Command over gRPC

    grpc_client ->> ankaios_agent ++- -: forward Exection Command

    deactivate ankaios_agent

    ...

end

== Forward State Change Commands ==

ankaios_agent ->> grpc_client ++- -: send State Change Command

grpc_client ->> agent_connection ++- -: forward State Change \n Command over gRPC

agent_connection - ->> ankaios_server ++- -: forward State Change Command
@end

PlantUML version 1.2022.7(Mon Aug 22 17:01:30 UTC 2022)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: ANSI_X3.4-1968
Language: en
Country: US
--></g></svg>